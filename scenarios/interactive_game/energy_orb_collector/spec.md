# インタラクティブ 3D コレクションゲーム 仕様書

本ドキュメントは Three.js を用いて `scenarios/interactive_game/energy_orb_collector/generated` 配下に生成するシンプルかつ拡張性の高い 3D コレクションゲームの詳細仕様です。最小可用プロトタイプ(MVP)を迅速に構築しつつ、後続の難易度調整・演出拡張・マルチデバイス対応を見据えた設計指針を含みます。

---

## 1. コアコンセプト

制限時間内に 3D 空間を探索し、出現する「エナジーオーブ (仮称)」をできるだけ多く回収してハイスコアを目指すアーケードライクな短時間集中型ゲーム。1 プレイ 60〜120 秒のセッションで気軽に何度もリトライでき、回収ルート最適化と反射的操作がリプレイ性を生む。

## 2. コアゲームループ

1. セッション開始: カウントダウン → タイマー始動
2. 探索 & 移動: プレイヤーがフィールド内を移動
3. オーブ接触: スコア加算 & 演出 (光/SE) → オーブ再配置 or 消滅
4. 動的変化: 一定間隔で新規オーブ出現 / 難易度補正
5. タイマー 0: セッション終了 → リザルト表示 → リトライ or 終了

## 3. プレイフィール指針

- 直感的: 「動く → 集める → 気持ちよいフィードバック」まで 5 秒以内
- 反応性: 入力遅延を体感 50ms 以下 (ブラウザ標準で問題なし)
- 明瞭性: 何を取れば良いか瞬時に理解できる発光・色彩コントラスト
- ループ性: 平均 3 プレイまでは飽きずに続けたくなるテンポ (1 プレイ 90 秒想定)

## 4. テクニカル要件 (MVP)

- Three.js 最新安定版 (CDN 想定)
- ビルド環境不要、HTML/JavaScript/CSS で構成されブラウザで直接動作
- 1 ファイルあたり責務分離: `scene setup`, `input`, `game state`, `spawner`, `ui`
- ターゲット: 直近 2 バージョンの Chrome / Firefox / Edge / Safari (PC)

## 5. フィールド & 空間設計

- 形状: 平面 (例: 50 x 50 ユニット) + 視認性向上のためのグリッド or 淡いテクスチャ
- 境界: 見えないコリジョン (外へ出られない) または低壁 / フォグで誘導
- カメラ: 追従型 3rd person (軽いラグ 0.1〜0.2s で滑らかさ) もしくは俯瞰固定 (MVP は固定 or 簡易追従で可)

## 6. プレイヤーキャラクター (PC)

- 形状: MVP はカラーマテリアルの簡易メッシュ (Sphere / Box)
- 移動: 方向キー / WASD (8 方向 + 斜め) / 押下中は一定速度
- 速度パラメータ: baseSpeed = 8 (ユニット/秒)・加速なし (後続アップグレード余地あり)
- コリジョン: オーブとの距離閾値 (例: 1.2 ユニット以内) で取得判定

## 7. 入力仕様

- キー: WASD / 矢印 (両対応)
- 同時押し: 対角方向の正規化 (√2 で割って速度一定)
- 連続入力遅延: なし (keyup / keydown で状態管理)
- 予備: 将来のゲームパッド対応フック (抽象化レイヤー `InputController`)
- マウスドラッグ: カメラ操作

## 8. 目標物 (エナジーオーブ)

- スポーン数制限: 最大同時 15 個 (MVP では 10〜12 推奨)
- 初期配置: ゲーム開始時に N 個一括生成
- 再配置方式: 取得時に 1 個ずつランダム座標再生成 (重複最小化)
- ランダム生成範囲: フィールド境界内 - マージン (例: ±(size/2 - 2))
- 視認性: 自己発光 (emissive) + 簡易パルスアニメ (後続任意)
- 取得演出: 瞬間スケールアップ → フェードアウト 0.25s (MVP: 即消滅でも可)

## 9. スコアリング

- 基本点: 1 オーブ = 100 pts (可変定数)
- 連続取得ボーナス (任意拡張): 5 秒以内連続で +10% 乗算スタック (MVP では未実装でも可、拡張設計をコメントに残す)
- リザルト: 総スコア + 1 秒あたり平均獲得数 (指標) を表示

## 10. タイマー & セッション

- デフォルト制限時間: 90 秒 (URL パラメータまたは定数で調整可能)
- 残り 10 秒で UI 点滅 / カウントダウン SE (SE は後続)
- 0 到達で入力無効化 → カメラ静止 → 結果 UI

## 11. 難易度スケーリング (軽量動的調整案)

| 時間経過 | 変更例            |
| -------- | ----------------- |
| 0〜30s   | 同時スポーン 8 個 |
| 30〜60s  | 10 個             |
| 60〜90s  | 12 個             |

MVP 実装: 時間閾値で maxSpawn を切替。追加要素 (未実装): 移動速度微増 / レアオーブ出現等。

## 12. UI / 状態遷移

ステート: `TITLE -> COUNTDOWN -> PLAYING -> RESULT -> (RETRY -> COUNTDOWN ...)`

コンポーネント:

- タイトル画面: ゲーム名 + Start ボタン / 操作説明
- プレイ HUD: 残り時間 / スコア / (任意) 同時オーブ数
- 結果画面: 最終スコア / 平均 / ハイスコア (localStorage) / Retry ボタン
- アクセシビリティ: 色覚多様性配慮のコントラスト (背景とオーブ色差 > WCAG 推奨比)

## 13. オーディオ (初期はダミー)

- 取得 SE / カウントダウン SE / 終了ジングル (MVP: 実装スキップ可、フック関数設計)

## 14. コード構成 (想定)

```text
generated/
	index.html          # エントリ (Canvas, UI コンテナ)
	styles.css          # 基本レイアウト / HUD
	main.js             # 初期化エントリ (Boot)
	scene.js            # Three.js シーン / カメラ / ライティング
	input.js            # 入力管理 (キーステート)
	gameState.js        # ステートマシン & タイマー
	spawner.js          # オーブ生成・再配置ロジック
	player.js           # プレイヤー表現 & 移動更新
	collectibles.js     # オーブエンティティ管理
	ui.js               # DOM UI (HUD/タイトル/結果)
	config.js           # 定数 (速度 / 時間 / スコア)
```

MVP 簡略化: `main.js` に集約しつつ段階的分割でも可。

## 15. パフォーマンス目標 (PC ブラウザ)

- 60 FPS 目標 (オーブ 15 / メッシュ総数 < 80 程度)
- GC スパイク抑制: 毎フレームの一時配列生成を避ける
- ウィンドウ非アクティブ時: requestAnimationFrame 自然減速を許容

## 16. 品質 / デバッグ

- ログレベル: `DEBUG_MODE` フラグで移動ベクトル・スポーン座標を console 出力
- ユニットテスト対象 (任意): 乱数スパウン範囲関数 / スコア計算関数

## 17. 拡張余地 (バックログ案)

- レアオーブ (高得点 / 出現確率 5%)
- スピードブーストアイテム
- マルチプレイ (WebSocket) 競争 / 協力
- デイリーチャレンジ (日替わり種別シード)
- デバイス別操作 (タッチ仮想スティック / ゲームパッド)

## 18. アート & トーン

- カラーパレット: 暖色系オーブ (オレンジ / イエロー) + 寒色系背景 (ブルー/ネイビー) で視認性強調
- 照明: アンビエント + 1 方向ライト (影は任意)
- UI: 最小限フラット / 角丸 / 半透明パネル (rgba(0,0,0,0.35))

## 19. アクセシビリティ配慮

- 重要情報は色 + 形 (オーブ発光 + 輪郭)
- 残り 10 秒はタイマー点滅 + ARIA ライブリージョンでスクリーンリーダー通知 (任意)

## 20. データ保持

- localStorage: `highScore` 保存
- バージョン差異による互換性崩れ時はキー名にバージョン付与

## 21. 実装優先度 (MVP 順)

1. シーン / カメラ / プレイヤー移動
2. オーブ生成 & 取得判定 & スコア
3. タイマー & ゲームステート
4. HUD / リザルト表示 & リトライ
5. 難易度スケーリング (スポーン数)
6. ハイスコア保存
7. 仕上げ (アニメ / 光沢 / パルス)

## 22. 完了定義 (DoD)

- 90 秒プレイ可能 / クラッシュなし
- オーブ取得でスコア加算が視認可
- 残り時間 0 で結果画面 → 再スタート動作
- ハイスコア保持がプレイ間で維持
- 主要ブラウザで 50+ FPS (開発機想定) を確認

## 23. 旧シンプル要件 (参照)

元の最小要件:

1. 移動
2. 接触でスコア
3. 制限時間内に収集
4. ランダム生成
5. WASD / 矢印操作
6. ゲームオーバー後のスコア表示 & 再スタート
7. シンプル UI

---

本仕様は MVP 実装後も拡張容易な構造を意図している。実装段階で追加の調整が必要な場合は `TODO:` コメントをコード内に明示し、優先度タグ (ex: `[P1]`) を付与すること。

---

更新日: 2025-08-29
